<!DOCTYPE html>
<html lang="en">
<head>
    <title>ProfessorsController</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/github.css" type="text/css" media="screen" />
<script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>


    <meta property="og:title" value="ProfessorsController">

  
    
    <meta name="description" content="Professor Controller  These actions perform operations related to the professor object  ACTIONS in the order they appear on the page:  ACTION  __ PERMISSIONS new    _ admin create _ admin index __ any.">
    <meta property="og:description" content="Professor Controller  These actions perform operations related to the professor object  ACTIONS in the order they appear on the page:  ACTION  __ PERMISSIONS new    _ admin create _ admin index __ any.">
  

    <meta name="keywords" content="ProfessorsController class">
  
    <meta name="keywords" content="new, create, index, search, edit, update, toggle_active, show, populate, preview, professor_courses">
  
</head>

<body>
    <div class="banner">
        
        <h1>
            <span class="type">Class</span>
            ProfessorsController
            
                <span class="parent">&lt;
                    
                    <a href="ApplicationController.html">ApplicationController</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../files/app/controllers/professors_controller_rb.html">app/controllers/professors_controller.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p><a href="Professor.html"><code>Professor</code></a> Controller</p>

<p>These actions perform operations related to the professor object</p>

<p>ACTIONS in the order they appear on the page:</p>

<p>ACTION  <em>__</em> PERMISSIONS new    <em>_</em> admin create <em>_</em> admin index <em>__</em> any user search <em>_</em> any user edit <em>_</em> admin update <em>_</em> admin <a href="ProfessorsController.html#method-i-toggle_active"><code>toggle_active</code></a> <em>__</em> admin show <em>_</em> any user populate <em>_</em> admin</p>

    </div>
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>C</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-create">create</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>E</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-edit">edit</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>I</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-index">index</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-new">new</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>P</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-populate">populate</a>,
              </li>
            
              
              <li>
                <a href="#method-i-preview">preview</a>,
              </li>
            
              
              <li>
                <a href="#method-i-professor_courses">professor_courses</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-search">search</a>,
              </li>
            
              
              <li>
                <a href="#method-i-show">show</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>T</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-toggle_active">toggle_active</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>U</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-update">update</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    


    


    <!-- Methods -->
    
    
      <div class="sectiontitle">Instance Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-create">
            
              <b>create</b>()
            
            <a href="../classes/ProfessorsController.html#method-i-create" name="method-i-create" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>create a new professor from form</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-create_source')" id="l_method-i-create_source">show</a>
                
              </p>
              <div id="method-i-create_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/controllers/professors_controller.rb, line 32</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">create</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-edit">
            
              <b>edit</b>()
            
            <a href="../classes/ProfessorsController.html#method-i-edit" name="method-i-edit" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>get the professor to be edited by the form</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-edit_source')" id="l_method-i-edit_source">show</a>
                
              </p>
              <div id="method-i-edit_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/controllers/professors_controller.rb, line 51</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">edit</span>
  <span class="ruby-ivar">@professor</span> = <span class="ruby-constant">Professor</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">fname:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:fname</span>], <span class="ruby-value">lname:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:lname</span>])[<span class="ruby-value">0</span>]

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@professor</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-comment"># Find the user who&#39;s name matches</span>
    <span class="ruby-ivar">@prof_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">fname:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:fname</span>], <span class="ruby-value">lname:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:lname</span>])[<span class="ruby-value">0</span>]
    <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@prof_user</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-comment"># Try to fond the professor based on the user&#39;s other info</span>
      <span class="ruby-ivar">@professor</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Professor</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-ivar">@prof_user</span>.<span class="ruby-identifier">prof_id</span>)
      <span class="ruby-ivar">@professor</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Professor</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">userid:</span> <span class="ruby-ivar">@prof_user</span>.<span class="ruby-identifier">email</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;@&#39;</span>)[<span class="ruby-value">0</span>])[<span class="ruby-value">0</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">nameerror_path</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@professor</span>.<span class="ruby-identifier">blank?</span>
  <span class="ruby-ivar">@professor</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-index">
            
              <b>index</b>()
            
            <a href="../classes/ProfessorsController.html#method-i-index" name="method-i-index" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>render the page with the professor search</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-index_source')" id="l_method-i-index_source">show</a>
                
              </p>
              <div id="method-i-index_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/controllers/professors_controller.rb, line 36</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">index</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-new">
            
              <b>new</b>()
            
            <a href="../classes/ProfessorsController.html#method-i-new" name="method-i-new" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>render the page with the form for a new professor</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-new_source')" id="l_method-i-new_source">show</a>
                
              </p>
              <div id="method-i-new_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/controllers/professors_controller.rb, line 28</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-populate">
            
              <b>populate</b>()
            
            <a href="../classes/ProfessorsController.html#method-i-populate" name="method-i-populate" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Unused. Also, don&#39;t use this. It&#39;s out of date. The LDAP connection shit is super different now. Also, if you used this it wouldn&#39;t connect the professors to courses or departments.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-populate_source')" id="l_method-i-populate_source">show</a>
                
              </p>
              <div id="method-i-populate_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/controllers/professors_controller.rb, line 127</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">populate</span>
  <span class="ruby-comment"># LDAP TIME!</span>
  <span class="ruby-identifier">ldap</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">LDAP</span>.<span class="ruby-identifier">new</span>( <span class="ruby-value">port:</span> <span class="ruby-value">389</span>, <span class="ruby-value">host:</span> <span class="ruby-string">&#39;ldap1.cc.oberlin.edu&#39;</span> )
  <span class="ruby-ivar">@names</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">ldap</span>.<span class="ruby-identifier">bind</span>
    <span class="ruby-comment"># query for role=Faculty</span>
    <span class="ruby-identifier">filter</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">LDAP</span><span class="ruby-operator">::</span><span class="ruby-constant">Filter</span>.<span class="ruby-identifier">eq</span>(<span class="ruby-string">&quot;o&quot;</span>,<span class="ruby-string">&quot;Faculty&quot;</span>)
    <span class="ruby-identifier">treebase</span> = <span class="ruby-string">&quot;ou=People,o=oberlin.edu,o=oberlin-college&quot;</span>
    <span class="ruby-ivar">@professors</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-identifier">ldap</span>.<span class="ruby-identifier">search</span>(<span class="ruby-value">base:</span> <span class="ruby-identifier">treebase</span>, <span class="ruby-value">filter:</span> <span class="ruby-identifier">filter</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">results</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@professors</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">results</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@professors</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>
      <span class="ruby-comment"># need to take out leading and trailing slashes, brackets, and quotes</span>
      <span class="ruby-identifier">mail</span> = <span class="ruby-identifier">p</span>.<span class="ruby-identifier">mail</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">2</span><span class="ruby-operator">..</span><span class="ruby-value">-3</span>)
      <span class="ruby-keyword">if</span> (<span class="ruby-constant">Professor</span>.<span class="ruby-identifier">find_by_email</span>(<span class="ruby-identifier">mail</span>) <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>)
        <span class="ruby-identifier">prof</span> = <span class="ruby-constant">Professor</span>.<span class="ruby-identifier">new</span>
        <span class="ruby-identifier">prof</span>.<span class="ruby-identifier">lname</span> = <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sn</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">2</span><span class="ruby-operator">..</span><span class="ruby-value">-3</span>)
        <span class="ruby-comment"># some professors share names with students, and have Faculty in their lname</span>
        <span class="ruby-identifier">prof</span>.<span class="ruby-identifier">lname</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-string">&#39;Faculty&#39;</span>,<span class="ruby-string">&#39;&#39;</span>) <span class="ruby-keyword">if</span> (<span class="ruby-identifier">prof</span>.<span class="ruby-identifier">lname</span>.<span class="ruby-identifier">include?</span> <span class="ruby-string">&#39;Faculty&#39;</span>)
        <span class="ruby-identifier">prof</span>.<span class="ruby-identifier">fname</span> = <span class="ruby-identifier">p</span>.<span class="ruby-identifier">givenname</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">2</span><span class="ruby-operator">..</span><span class="ruby-value">-3</span>)
        <span class="ruby-identifier">prof</span>.<span class="ruby-identifier">nickname</span> = <span class="ruby-string">&#39;&#39;</span>
        <span class="ruby-identifier">prof</span>.<span class="ruby-identifier">email</span> = <span class="ruby-identifier">mail</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">prof</span>.<span class="ruby-identifier">save</span>
          <span class="ruby-ivar">@names</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">prof</span>.<span class="ruby-identifier">fname</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot; &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">prof</span>.<span class="ruby-identifier">lname</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># array of the new professors</span>
  <span class="ruby-ivar">@names</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-preview">
            
              <b>preview</b>()
            
            <a href="../classes/ProfessorsController.html#method-i-preview" name="method-i-preview" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Function to generate a preview of a professor&#39;s more information content. Uses the redcarpet gem to render markdown formatted input as html.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-preview_source')" id="l_method-i-preview_source">show</a>
                
              </p>
              <div id="method-i-preview_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/controllers/professors_controller.rb, line 162</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">preview</span>
 <span class="ruby-comment"># @professor = Professor.where(fname: params[:fname], lname: params[:lname])[0]</span>
 <span class="ruby-comment"># @result = &quot;&quot;</span>
 <span class="ruby-comment"># @result ||= Redcarpet::Markdown.new(Redcarpet::Render::HTML, underline: true, highlight: true, lax_spacing: true).render(params[:professor][:content])</span>
 <span class="ruby-comment"># @result.html_safe</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-professor_courses">
            
              <b>professor_courses</b>()
            
            <a href="../classes/ProfessorsController.html#method-i-professor_courses" name="method-i-professor_courses" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Function to generate all the courses the professor has the permission to edit</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-professor_courses_source')" id="l_method-i-professor_courses_source">show</a>
                
              </p>
              <div id="method-i-professor_courses_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/controllers/professors_controller.rb, line 173</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">professor_courses</span>
  <span class="ruby-ivar">@professor</span> = <span class="ruby-constant">Professor</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">fname:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:fname</span>], <span class="ruby-value">lname:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:lname</span>])[<span class="ruby-value">0</span>]
  
  <span class="ruby-comment"># Fix for the &quot;Bob Geitz problem&quot; where the user&#39;s name is different from the professor&#39;s</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@professor</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-comment"># Find the user who&#39;s name matches</span>
    <span class="ruby-ivar">@prof_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">fname:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:fname</span>], <span class="ruby-value">lname:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:lname</span>])[<span class="ruby-value">0</span>]
    <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@prof_user</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-comment"># Try to fond the professor based on the user&#39;s other info</span>
      <span class="ruby-ivar">@professor</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Professor</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-ivar">@prof_user</span>.<span class="ruby-identifier">prof_id</span>)
      <span class="ruby-ivar">@professor</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Professor</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">userid:</span> <span class="ruby-ivar">@prof_user</span>.<span class="ruby-identifier">email</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;@&#39;</span>)[<span class="ruby-value">0</span>])[<span class="ruby-value">0</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment">#Redirects to the nameerror file with a text field to allow professors to let us know their accounts aren&#39;t connected</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">nameerror_path</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@professor</span>.<span class="ruby-identifier">blank?</span>

  <span class="ruby-ivar">@prof_cart</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">cart</span>.<span class="ruby-identifier">get_courses</span>
  <span class="ruby-ivar">@prof_courses</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">short_cur_sem</span> = <span class="ruby-identifier">view_context</span>.<span class="ruby-identifier">current_semester</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">downcase</span><span class="ruby-operator">+</span><span class="ruby-identifier">view_context</span>.<span class="ruby-identifier">current_semester</span>[<span class="ruby-value">-2</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>]
  
  <span class="ruby-ivar">@prof_courses</span>[<span class="ruby-string">&quot;teaching&quot;</span>]=<span class="ruby-ivar">@professor</span>.<span class="ruby-identifier">courses</span>.<span class="ruby-identifier">delete_if</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">semester</span><span class="ruby-operator">!=</span><span class="ruby-identifier">short_cur_sem</span>}
  <span class="ruby-ivar">@prof_courses</span>[<span class="ruby-string">&quot;requests&quot;</span>] = <span class="ruby-ivar">@prof_cart</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@prof_cart</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
  
  <span class="ruby-ivar">@professor</span>.<span class="ruby-identifier">departments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">qs</span>  = <span class="ruby-string">&#39;( dept LIKE &#39;</span><span class="ruby-operator">+</span><span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">quote</span>(<span class="ruby-string">&quot;%&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">d</span>.<span class="ruby-identifier">dept</span><span class="ruby-string">+&quot;%&quot;</span>)<span class="ruby-string">+&quot; AND semester=&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">quote</span>(<span class="ruby-identifier">short_cur_sem</span>) <span class="ruby-operator">+</span> <span class="ruby-string">&quot;)&quot;</span>
    <span class="ruby-identifier">dept_courses</span> = <span class="ruby-constant">Course</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">qs</span>).<span class="ruby-identifier">sort</span>
    <span class="ruby-ivar">@prof_courses</span>[<span class="ruby-identifier">d</span>.<span class="ruby-identifier">dept</span>] = <span class="ruby-identifier">dept_courses</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">dept_courses</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
  <span class="ruby-keyword">end</span>
  
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-search">
            
              <b>search</b>()
            
            <a href="../classes/ProfessorsController.html#method-i-search" name="method-i-search" class="permalink">Link</a>
          </div>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-search_source')" id="l_method-i-search_source">show</a>
                
              </p>
              <div id="method-i-search_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/controllers/professors_controller.rb, line 39</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">search</span>
  <span class="ruby-comment"># return nothing if no query made</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:name</span>].<span class="ruby-identifier">blank?</span>
  <span class="ruby-comment"># search by both first name and last name</span>
  <span class="ruby-ivar">@professors</span> = <span class="ruby-constant">Professor</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;fname LIKE &#39;%#{params[:name]}%&#39; OR lname LIKE &#39;%#{params[:name]}%&#39;&quot;</span>).<span class="ruby-identifier">to_a</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-show">
            
              <b>show</b>()
            
            <a href="../classes/ProfessorsController.html#method-i-show" name="method-i-show" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>render the professor page</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-show_source')" id="l_method-i-show_source">show</a>
                
              </p>
              <div id="method-i-show_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/controllers/professors_controller.rb, line 90</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">show</span>
  <span class="ruby-ivar">@professor</span> = <span class="ruby-constant">Professor</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">fname:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:fname</span>], <span class="ruby-value">lname:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:lname</span>])[<span class="ruby-value">0</span>]
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">error_404_path</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@professor</span>
  <span class="ruby-identifier">all_comments</span> = <span class="ruby-ivar">@professor</span>.<span class="ruby-identifier">root_comments</span>
  <span class="ruby-ivar">@comments</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">all_comments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@comments</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;removed&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">old</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@comments</span> = <span class="ruby-constant">Comment</span>.<span class="ruby-identifier">sort_by_score</span>(<span class="ruby-ivar">@comments</span>)
  <span class="ruby-comment"># build a hash to return the professor and its comments</span>
  <span class="ruby-ivar">@vals</span> = {}
  <span class="ruby-ivar">@vals</span>[<span class="ruby-value">:professor</span>] = <span class="ruby-ivar">@professor</span>
  <span class="ruby-ivar">@vals</span>[<span class="ruby-value">:comments</span>] = <span class="ruby-ivar">@comments</span>
  
  <span class="ruby-ivar">@hubcourses</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">prev_semcrn</span> = <span class="ruby-value">-1</span>
  <span class="ruby-identifier">prof_all_courses</span> = <span class="ruby-ivar">@professor</span>.<span class="ruby-identifier">courses</span>.<span class="ruby-identifier">sort</span>
  <span class="ruby-identifier">prof_all_courses</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">course</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">course</span>.<span class="ruby-identifier">semcrn</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">prev_semcrn</span>
    <span class="ruby-identifier">prev_semcrn</span> = <span class="ruby-identifier">course</span>.<span class="ruby-identifier">semcrn</span>
    <span class="ruby-ivar">@hubcourses</span>[<span class="ruby-identifier">course</span>.<span class="ruby-identifier">hubcourse</span>] <span class="ruby-operator">||=</span> [] <span class="ruby-keyword">unless</span> <span class="ruby-identifier">course</span>.<span class="ruby-identifier">status</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;hidden&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">course</span>.<span class="ruby-identifier">status</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;cancelled&quot;</span>
    <span class="ruby-ivar">@hubcourses</span>[<span class="ruby-identifier">course</span>.<span class="ruby-identifier">hubcourse</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">course</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">course</span>.<span class="ruby-identifier">status</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;hidden&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">course</span>.<span class="ruby-identifier">status</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;cancelled&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@vals</span>[<span class="ruby-value">:hubcourses</span>] = <span class="ruby-ivar">@hubcourses</span>

  <span class="ruby-ivar">@vals</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">csv</span> { <span class="ruby-identifier">render</span> <span class="ruby-value">plain:</span> <span class="ruby-ivar">@professor</span>.<span class="ruby-identifier">to_csv</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:enroll</span>]<span class="ruby-operator">||=</span><span class="ruby-value">0</span>) }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-toggle_active">
            
              <b>toggle_active</b>()
            
            <a href="../classes/ProfessorsController.html#method-i-toggle_active" name="method-i-toggle_active" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>switch a professor between active and dark</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-toggle_active_source')" id="l_method-i-toggle_active_source">show</a>
                
              </p>
              <div id="method-i-toggle_active_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/controllers/professors_controller.rb, line 82</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">toggle_active</span>
  <span class="ruby-ivar">@professor</span> = <span class="ruby-constant">Professor</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">fname:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:fname</span>], <span class="ruby-value">lname:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:lname</span>])[<span class="ruby-value">0</span>]
  <span class="ruby-ivar">@professor</span>.<span class="ruby-identifier">toggle_status</span>
  <span class="ruby-ivar">@professor</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-ivar">@professor</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-update">
            
              <b>update</b>()
            
            <a href="../classes/ProfessorsController.html#method-i-update" name="method-i-update" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>change the professor according to the form</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-update_source')" id="l_method-i-update_source">show</a>
                
              </p>
              <div id="method-i-update_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/controllers/professors_controller.rb, line 69</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">update</span>
  <span class="ruby-ivar">@professor</span> = <span class="ruby-constant">Professor</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@professor</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">params_professor</span>)
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:success</span>] = <span class="ruby-string">&quot;Profile successfully updated!&quot;</span>
    <span class="ruby-comment"># go to the professor profile</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">show_professor_path</span>(<span class="ruby-value">fname:</span> <span class="ruby-ivar">@professor</span>.<span class="ruby-identifier">fname</span>, <span class="ruby-value">lname:</span> <span class="ruby-ivar">@professor</span>.<span class="ruby-identifier">lname</span>)
  <span class="ruby-keyword">else</span> <span class="ruby-comment"># the professor could not be saved (for some reason)</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">edit_professor_path</span>(<span class="ruby-value">fname:</span> <span class="ruby-ivar">@professor</span>.<span class="ruby-identifier">fname</span>, <span class="ruby-value">lname:</span> <span class="ruby-ivar">@professor</span>.<span class="ruby-identifier">lname</span>), <span class="ruby-value">:notice</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;Settings could not be changed. Please contact the Prestissmo managers!&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
  
</div>

    </div>
  </body>
</html>
