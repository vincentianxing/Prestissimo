<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class CoursesController - Prestissimo Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script src="./js/jquery.js"></script>
<script src="./js/darkfish.js"></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="ApplicationController.html">ApplicationController</a>
  
</div>

    <div id="includes-section" class="nav-section">
  <h3>Included Modules</h3>

  <ul class="link-list">
  
  
    <li><a class="include" href="ApplicationHelper.html">ApplicationHelper</a>
  
  
  
    <li><span class="include">ActionView::Helpers::TextHelper</span>
  
  
  </ul>
</div>

    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-i-create">#create</a>
    
    <li ><a href="#method-i-edit">#edit</a>
    
    <li ><a href="#method-i-index">#index</a>
    
    <li ><a href="#method-i-new">#new</a>
    
    <li ><a href="#method-i-search">#search</a>
    
    <li ><a href="#method-i-update">#update</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-CoursesController">
  <h1 id="class-CoursesController" class="class">
    class CoursesController
  </h1>

  <section class="description">
    
  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-create" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>CREATE action: empty</p>
          
          

          
          <div class="method-source-code" id="create-source">
            <pre><span class="ruby-comment"># File app/controllers/courses_controller.rb, line 6</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-edit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">edit</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>EDIT action: empty</p>
          
          

          
          <div class="method-source-code" id="edit-source">
            <pre><span class="ruby-comment"># File app/controllers/courses_controller.rb, line 14</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">edit</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">root_path</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">signed_in?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">faculty_user?</span>(<span class="ruby-identifier">current_user</span>)
  <span class="ruby-ivar">@courses</span> = <span class="ruby-constant">Course</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">semcrn</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:semcrn</span>])
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">error_404_path</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@courses</span>
  <span class="ruby-ivar">@sections</span> = <span class="ruby-constant">Course</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">dept</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@courses</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">dept</span>, <span class="ruby-identifier">cnum</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@courses</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">cnum</span>, <span class="ruby-identifier">semester</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@courses</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">semester</span>)
  <span class="ruby-ivar">@sections</span>.<span class="ruby-identifier">sort_by!</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">crn</span>}
  <span class="ruby-ivar">@course_arr</span> = [<span class="ruby-ivar">@courses</span>, <span class="ruby-ivar">@sections</span>]
  <span class="ruby-ivar">@course_arr</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-index" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">index</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>INDEX action: used to render the javascript and search results</p>
          
          

          
          <div class="method-source-code" id="index-source">
            <pre><span class="ruby-comment"># File app/controllers/courses_controller.rb, line 124</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">index</span>
  <span class="ruby-comment">#if !cookies[:mobile_format].nil? &amp;&amp; is_mobile_device?</span>
  <span class="ruby-comment">#   session[:mobile_view] = true</span>
  <span class="ruby-comment">#end</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:cart</span>]
     <span class="ruby-ivar">@cart</span> = <span class="ruby-constant">Cart</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@cart</span>.<span class="ruby-identifier">save</span>
      <span class="ruby-identifier">cookies</span>.<span class="ruby-identifier">permanent</span>[<span class="ruby-value">:cart</span>] = <span class="ruby-ivar">@cart</span>.<span class="ruby-identifier">cartid</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@cart</span>.<span class="ruby-identifier">total_credits</span> = <span class="ruby-value">0</span>
    <span class="ruby-ivar">@cart</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:value</span>].<span class="ruby-identifier">blank?</span>
    <span class="ruby-ivar">@courses</span> = <span class="ruby-constant">Cart</span>.<span class="ruby-identifier">find_by_cartid</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:value</span>]).<span class="ruby-identifier">get_courses</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">mobile</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>NEW action: empty</p>
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File app/controllers/courses_controller.rb, line 10</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">new</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-search" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>SEARCH action: performs course search</p>

<pre>- builds a &#39;query string,&#39; used to query SQL database, based on form
   field input</pre>
          
          

          
          <div class="method-source-code" id="search-source">
            <pre><span class="ruby-comment"># File app/controllers/courses_controller.rb, line 149</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">search</span>
    <span class="ruby-identifier">qs</span> = <span class="ruby-string">&#39;&#39;</span> <span class="ruby-comment"># Query String</span>
<span class="ruby-comment">#    qs = &#39;SELECT courses.* FROM courses WHERE (&#39; # Query String</span>

    <span class="ruby-comment">#CRN Conditional</span>
    <span class="ruby-comment"># Searches for the course whose CRN = the query</span>
    <span class="ruby-comment"># Skips other fields when used</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:crn</span>].<span class="ruby-identifier">blank?</span>)
      <span class="ruby-identifier">qs</span> = <span class="ruby-node">&quot;crn = #{ActiveRecord::Base.connection.quote(&quot;#{params[:crn]}&quot;)} AND &quot;</span>

      <span class="ruby-comment">#Semester Select Conditional</span>
      <span class="ruby-comment"># Uses &#39;LIKE&#39; comparison</span>
      <span class="ruby-comment"># Converts from human-readable semester format to table semester shorthand</span>
      <span class="ruby-comment">#  FORMAT: [First letter of Season][Last two digits of Year]</span>
      <span class="ruby-comment">#  F12 - Fall 2012</span>
      <span class="ruby-comment">#  S12 - Spring 2012</span>
      <span class="ruby-comment">#  and so on</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:semester</span>].<span class="ruby-identifier">blank?</span>)
        <span class="ruby-identifier">semester</span> = <span class="ruby-identifier">translate_semester</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:semester</span>])
        <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">likeAppend</span>(<span class="ruby-string">&quot;semester&quot;</span>, <span class="ruby-node">&quot;#{semester}&quot;</span>, <span class="ruby-identifier">qs</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment"># Removes the trailing &#39; AND &#39; from the query string</span>
      <span class="ruby-value">5</span>.<span class="ruby-identifier">times</span> { <span class="ruby-identifier">qs</span>.<span class="ruby-identifier">chop!</span> }
    <span class="ruby-keyword">else</span> <span class="ruby-comment"># skips all other fields when a CRN is specified</span>

      <span class="ruby-comment">#Course Name Conditional</span>
      <span class="ruby-comment"># Uses &#39;LIKE&#39; comparison</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:cname</span>].<span class="ruby-identifier">blank?</span>)
        <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">likeAppend</span>(<span class="ruby-string">&quot;title&quot;</span>, <span class="ruby-node">&quot;#{params[:cname]}&quot;</span>, <span class="ruby-identifier">qs</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment">#Professor Conditional</span>
      <span class="ruby-comment"># Uses &#39;LIKE&#39; comparison</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:professor</span>].<span class="ruby-identifier">blank?</span>)
        <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">likeAppend</span>(<span class="ruby-string">&quot;professor&quot;</span>, <span class="ruby-node">&quot;#{params[:professor]}&quot;</span>, <span class="ruby-identifier">qs</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment">#Department Conditional</span>
      <span class="ruby-comment"># Uses &#39;LIKE&#39; comparison</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:dept</span>].<span class="ruby-identifier">blank?</span>)
        <span class="ruby-identifier">dept</span> = <span class="ruby-node">&quot;#{params[:dept]}&quot;</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot; &quot;</span>)
        <span class="ruby-identifier">asize</span> = <span class="ruby-identifier">dept</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>;
        (<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-identifier">asize</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword">if</span> (<span class="ruby-identifier">asize</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>)
            <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">likeAppend</span>(<span class="ruby-string">&quot;dept&quot;</span>, <span class="ruby-identifier">dept</span>[<span class="ruby-identifier">c</span>], <span class="ruby-identifier">qs</span>)
          <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">c</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>)
            <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">orAppend</span>(<span class="ruby-string">&quot;(dept&quot;</span>, <span class="ruby-identifier">dept</span>[<span class="ruby-identifier">c</span>], <span class="ruby-identifier">qs</span>)
          <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">c</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">asize</span>)
            <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">orAppend</span>(<span class="ruby-string">&quot;dept&quot;</span>, <span class="ruby-identifier">dept</span>[<span class="ruby-identifier">c</span>], <span class="ruby-identifier">qs</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">likeAppendMulti</span>(<span class="ruby-string">&quot;dept&quot;</span>, <span class="ruby-identifier">dept</span>[<span class="ruby-identifier">c</span>], <span class="ruby-identifier">qs</span>)
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment">#Semester Select Conditional</span>
      <span class="ruby-comment"># Uses &#39;LIKE&#39; comparison</span>
      <span class="ruby-comment"># Converts from human-readable semester format to table semester shorthand</span>
      <span class="ruby-comment">#  FORMAT: [First letter of Season][Last two digits of Year]</span>
      <span class="ruby-comment">#  F12 - Fall 2012</span>
      <span class="ruby-comment">#  S12 - Spring 2012</span>
      <span class="ruby-comment">#  and so on</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:semester</span>].<span class="ruby-identifier">blank?</span>)
        <span class="ruby-identifier">semester</span> = <span class="ruby-identifier">translate_semester</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:semester</span>])
        <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">likeAppend</span>(<span class="ruby-string">&quot;semester&quot;</span>, <span class="ruby-node">&quot;#{semester}&quot;</span>, <span class="ruby-identifier">qs</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment">#Proficiency Conditionals</span>
      <span class="ruby-comment"># Use &#39;LIKE&#39; comparison</span>
      <span class="ruby-comment">#  Converts from checkbox &#39;ON&#39;/&#39;OFF&#39; format to string</span>
      <span class="ruby-comment">#  Profs. stored as a string containing all credited profs,</span>
      <span class="ruby-comment">#  i.e. &quot;CD,WR&quot;</span>

      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:cd</span>].<span class="ruby-identifier">blank?</span>)
        <span class="ruby-identifier">cd</span> = <span class="ruby-string">&quot;CD&quot;</span>
        <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">likeAppend</span>(<span class="ruby-string">&quot;proficiencies&quot;</span>, <span class="ruby-node">&quot;#{cd}&quot;</span>, <span class="ruby-identifier">qs</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:wr</span>].<span class="ruby-identifier">blank?</span>)
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:profic</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;wadv&quot;</span>)
          <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">likeAppend</span>(<span class="ruby-string">&quot;proficiencies&quot;</span>, <span class="ruby-string">&quot;WAdv&quot;</span>, <span class="ruby-identifier">qs</span>)
        <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:profic</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;wint&quot;</span>)
          <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">likeAppend</span>(<span class="ruby-string">&quot;proficiencies&quot;</span>, <span class="ruby-string">&quot;WInt&quot;</span>, <span class="ruby-identifier">qs</span>)
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">orAppend</span>(<span class="ruby-string">&quot;(proficiencies&quot;</span>, <span class="ruby-string">&quot;WInt&quot;</span>, <span class="ruby-identifier">qs</span>)
          <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">orAppend</span>(<span class="ruby-string">&quot;proficiencies&quot;</span>, <span class="ruby-string">&quot;WR&quot;</span>, <span class="ruby-identifier">qs</span>)
          <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">likeAppendMulti</span>(<span class="ruby-string">&quot;proficiencies&quot;</span>, <span class="ruby-string">&quot;WAdv&quot;</span>, <span class="ruby-identifier">qs</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:qfr</span>].<span class="ruby-identifier">blank?</span>)
        <span class="ruby-identifier">qfr</span> = <span class="ruby-string">&quot;QFR&quot;</span>
        <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">orAppend</span>(<span class="ruby-string">&quot;(proficiencies&quot;</span>, <span class="ruby-string">&quot;QP&quot;</span>, <span class="ruby-identifier">qs</span>)
        <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">likeAppendMulti</span>(<span class="ruby-string">&quot;proficiencies&quot;</span>, <span class="ruby-node">&quot;#{qfr}&quot;</span>, <span class="ruby-identifier">qs</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment">#Day of the Week Conditionals</span>
      <span class="ruby-comment"># Use &#39;LIKE&#39; comparison</span>
      <span class="ruby-comment">#  Converts from checkbox &#39;ON&#39;/&#39;OFF&#39; format to string,</span>
      <span class="ruby-comment">#  single letter day notation, using PRESTO standard [MWTRFSU]</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:monday</span>].<span class="ruby-identifier">blank?</span>)
        <span class="ruby-identifier">monday</span> = <span class="ruby-string">&quot;M&quot;</span>
        <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">likeAppend</span>(<span class="ruby-string">&quot;days&quot;</span>, <span class="ruby-node">&quot;#{monday}&quot;</span>, <span class="ruby-identifier">qs</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:tuesday</span>].<span class="ruby-identifier">blank?</span>)
        <span class="ruby-identifier">tuesday</span> = <span class="ruby-string">&quot;T&quot;</span>
        <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">likeAppend</span>(<span class="ruby-string">&quot;days&quot;</span>, <span class="ruby-node">&quot;#{tuesday}&quot;</span>, <span class="ruby-identifier">qs</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:wednesday</span>].<span class="ruby-identifier">blank?</span>)
        <span class="ruby-identifier">wednesday</span> = <span class="ruby-string">&quot;W&quot;</span>
        <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">likeAppend</span>(<span class="ruby-string">&quot;days&quot;</span>, <span class="ruby-node">&quot;#{wednesday}&quot;</span>, <span class="ruby-identifier">qs</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:thursday</span>].<span class="ruby-identifier">blank?</span>)
        <span class="ruby-identifier">thursday</span> = <span class="ruby-string">&quot;R&quot;</span>
        <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">likeAppend</span>(<span class="ruby-string">&quot;days&quot;</span>, <span class="ruby-node">&quot;#{thursday}&quot;</span>, <span class="ruby-identifier">qs</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:friday</span>].<span class="ruby-identifier">blank?</span>)
        <span class="ruby-identifier">friday</span> = <span class="ruby-string">&quot;F&quot;</span>
        <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">likeAppend</span>(<span class="ruby-string">&quot;days&quot;</span>, <span class="ruby-node">&quot;#{friday}&quot;</span>, <span class="ruby-identifier">qs</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:saturday</span>].<span class="ruby-identifier">blank?</span>)
        <span class="ruby-identifier">saturday</span> = <span class="ruby-string">&quot;S&quot;</span>
        <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">likeAppend</span>(<span class="ruby-string">&quot;days&quot;</span>, <span class="ruby-node">&quot;#{saturday}&quot;</span>, <span class="ruby-identifier">qs</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:sunday</span>].<span class="ruby-identifier">blank?</span>)
        <span class="ruby-identifier">sunday</span> = <span class="ruby-string">&quot;U&quot;</span>
        <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">likeAppend</span>(<span class="ruby-string">&quot;days&quot;</span>, <span class="ruby-node">&quot;#{sunday}&quot;</span>, <span class="ruby-identifier">qs</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment"># Full Course Conditionals</span>
      <span class="ruby-comment"># Use &#39;LIKE&#39; comparison</span>
      <span class="ruby-keyword">if</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:fc</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;fc&quot;</span>)
        <span class="ruby-identifier">fc</span> = <span class="ruby-string">&quot;Full Course&quot;</span>
        <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">likeAppend</span>(<span class="ruby-string">&quot;full_course&quot;</span>, <span class="ruby-node">&quot;#{fc}&quot;</span>, <span class="ruby-identifier">qs</span>)
      <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:fc</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;hc&quot;</span>)
        <span class="ruby-identifier">hc</span> = <span class="ruby-string">&quot;Half Course&quot;</span>
        <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">likeAppend</span>(<span class="ruby-string">&quot;full_course&quot;</span>, <span class="ruby-node">&quot;#{hc}&quot;</span>, <span class="ruby-identifier">qs</span>)
      <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:fc</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;cc&quot;</span>)
        <span class="ruby-identifier">cc</span> = <span class="ruby-string">&quot;Co-Curricular&quot;</span>
        <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">likeAppend</span>(<span class="ruby-string">&quot;full_course&quot;</span>, <span class="ruby-node">&quot;#{cc}&quot;</span>, <span class="ruby-identifier">qs</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment">#Module Conditionals</span>
      <span class="ruby-comment"># Use &#39;LIKE&#39; comparison</span>
      <span class="ruby-comment">#  Converts from checkbox &#39;ON&#39;/&#39;OFF&#39; to integers. Modules stored as:</span>
      <span class="ruby-comment">#  1: first mod</span>
      <span class="ruby-comment">#  2: second mod</span>
      <span class="ruby-comment">#  3: full semester</span>
      <span class="ruby-comment">#  4: special meeting times</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:module</span>].<span class="ruby-identifier">blank?</span>)
        <span class="ruby-identifier">mod</span>=<span class="ruby-value">0</span>;
        <span class="ruby-keyword">if</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:module</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;mod1&quot;</span>)
          <span class="ruby-identifier">mod</span> = <span class="ruby-value">1</span>
        <span class="ruby-keyword">elsif</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:module</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;mod2&quot;</span>)
          <span class="ruby-identifier">mod</span> = <span class="ruby-value">2</span>
        <span class="ruby-keyword">elsif</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:module</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;full&quot;</span>)
          <span class="ruby-identifier">mod</span> = <span class="ruby-value">3</span>
        <span class="ruby-keyword">elsif</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:module</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;spec&quot;</span>)
          <span class="ruby-identifier">mod</span> = <span class="ruby-value">4</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span>(<span class="ruby-identifier">mod</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>)
          <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">likeAppend</span>(<span class="ruby-string">&quot;mods&quot;</span>, <span class="ruby-node">&quot;#{mod}&quot;</span>, <span class="ruby-identifier">qs</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment">#Attribute Conditionals</span>
      <span class="ruby-comment">#Assumed: max value is always filled, where credit for attribute is given</span>
      <span class="ruby-comment"># Uses a numerical comparison, and returns all classes where the selected</span>
      <span class="ruby-comment">#  attribute gives strictly greater than 0 credits</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:ns</span>].<span class="ruby-identifier">blank?</span>)
        <span class="ruby-identifier">ns</span> = <span class="ruby-string">&quot;NS&quot;</span>
        <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">likeAppend</span>(<span class="ruby-string">&quot;distributions&quot;</span>, <span class="ruby-node">&quot;#{ns}&quot;</span>, <span class="ruby-identifier">qs</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:ss</span>].<span class="ruby-identifier">blank?</span>)
        <span class="ruby-identifier">ss</span> = <span class="ruby-string">&quot;SS&quot;</span>
        <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">likeAppend</span>(<span class="ruby-string">&quot;distributions&quot;</span>, <span class="ruby-node">&quot;#{ss}&quot;</span>, <span class="ruby-identifier">qs</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:hu</span>].<span class="ruby-identifier">blank?</span>)
        <span class="ruby-identifier">hu</span> = <span class="ruby-string">&quot;HU&quot;</span>
        <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">likeAppend</span>(<span class="ruby-string">&quot;distributions&quot;</span>, <span class="ruby-node">&quot;#{hu}&quot;</span>, <span class="ruby-identifier">qs</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment">#Con Attribute Conditionals</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:cndp</span>].<span class="ruby-identifier">blank?</span>)
        <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">likeAppend</span>(<span class="ruby-string">&quot;distributions&quot;</span>, <span class="ruby-string">&quot;CNDP&quot;</span>, <span class="ruby-identifier">qs</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:ddhu</span>].<span class="ruby-identifier">blank?</span>)
        <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">likeAppend</span>(<span class="ruby-string">&quot;distributions&quot;</span>, <span class="ruby-string">&quot;DDHU&quot;</span>, <span class="ruby-identifier">qs</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment">#Number of Credits Conditionals</span>
      <span class="ruby-comment"># Uses numerical comparisons, and searches in an inclusive range</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:min_credits</span>].<span class="ruby-identifier">blank?</span>)
        <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">numAppend</span>(<span class="ruby-string">&quot;crmin&quot;</span>, <span class="ruby-node">&quot;#{params[:min_credits]}&quot;</span>, <span class="ruby-string">&quot;&gt;=&quot;</span>, <span class="ruby-identifier">qs</span>)
      <span class="ruby-keyword">end</span>

      
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:max_credits</span>].<span class="ruby-identifier">blank?</span>)
        <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_credits</span>]=<span class="ruby-string">&quot;99&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_credits</span>].<span class="ruby-identifier">to_i</span><span class="ruby-operator">&gt;</span><span class="ruby-value">8</span>
        <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">numAppend</span>(<span class="ruby-string">&quot;crmax&quot;</span>, <span class="ruby-node">&quot;#{params[:max_credits]}&quot;</span>, <span class="ruby-string">&quot;&lt;=&quot;</span>, <span class="ruby-identifier">qs</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment">#Time Conditionals</span>
      <span class="ruby-comment"># Somewhat more intuitively: if &quot;start after&quot; is entered, will list all classes &gt;= given start time.</span>
      <span class="ruby-comment"># If &quot;end before&quot; is specified, will list all classes &lt;= the given end time.</span>
      <span class="ruby-comment">#Start Time Conditionals</span>
      <span class="ruby-keyword">unless</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:start_hour</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;7&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:start_minute</span>]=<span class="ruby-string">&quot;00&quot;</span> <span class="ruby-operator">&amp;&amp;</span>  <span class="ruby-identifier">params</span>[<span class="ruby-value">:end_hour</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;22&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:end_minute</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;00&quot;</span>)
        <span class="ruby-identifier">start_hour</span> = <span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:start_hour</span>].<span class="ruby-identifier">blank?</span>)
          <span class="ruby-identifier">start_hour</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:start_hour</span>]<span class="ruby-operator">+</span><span class="ruby-string">&quot;:&quot;</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:start_minute</span>].<span class="ruby-identifier">blank?</span>)
            <span class="ruby-identifier">start_hour</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:start_minute</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;:00&quot;</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">start_hour</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;00:00&quot;</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-comment">#End Time Conditionals</span>
        <span class="ruby-identifier">end_hour</span> = <span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:end_hour</span>].<span class="ruby-identifier">blank?</span>)
          <span class="ruby-identifier">end_hour</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:end_hour</span>]<span class="ruby-operator">+</span><span class="ruby-string">&quot;:&quot;</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:end_minute</span>].<span class="ruby-identifier">blank?</span>)
            <span class="ruby-identifier">end_hour</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:end_minute</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;:00&quot;</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">end_hour</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;00:00&quot;</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-comment">#Build the query string for times</span>
        <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">end_hour</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">start_hour</span>.<span class="ruby-identifier">blank?</span>)
          <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">numAppend</span>(<span class="ruby-string">&quot;start_time&quot;</span>, <span class="ruby-node">&quot;#{start_hour}&quot;</span>, <span class="ruby-string">&quot;&gt;=&quot;</span>, <span class="ruby-identifier">qs</span>)
          <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">numAppend</span>(<span class="ruby-string">&quot;end_time&quot;</span>, <span class="ruby-node">&quot;#{end_hour}&quot;</span>, <span class="ruby-string">&quot;&lt;=&quot;</span>, <span class="ruby-identifier">qs</span>)
        <span class="ruby-keyword">elsif</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">end_hour</span>.<span class="ruby-identifier">blank?</span>)
          <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">numAppend</span>(<span class="ruby-string">&quot;end_time&quot;</span>, <span class="ruby-node">&quot;#{end_hour}&quot;</span>, <span class="ruby-string">&quot;&lt;=&quot;</span>, <span class="ruby-identifier">qs</span>)
        <span class="ruby-keyword">elsif</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">start_hour</span>.<span class="ruby-identifier">blank?</span>)
          <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">numAppend</span>(<span class="ruby-string">&quot;start_time&quot;</span>, <span class="ruby-node">&quot;#{start_hour}&quot;</span>, <span class="ruby-string">&quot;&gt;=&quot;</span>, <span class="ruby-identifier">qs</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment">#Course Level Search</span>
      <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:min_course_level</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_course_level</span>].<span class="ruby-identifier">blank?</span>
        <span class="ruby-identifier">min_level</span> = <span class="ruby-constant">Integer</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:min_course_level</span>])
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">min_level</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
          <span class="ruby-identifier">min_level</span> = <span class="ruby-string">&quot;000&quot;</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">max_level</span> = <span class="ruby-constant">Integer</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:max_course_level</span>])
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">max_level</span> <span class="ruby-operator">==</span> <span class="ruby-value">99</span>
          <span class="ruby-identifier">max_level</span> = <span class="ruby-string">&quot;099&quot;</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">max_level</span> <span class="ruby-operator">==</span> <span class="ruby-value">1000</span>
          <span class="ruby-identifier">max_level</span> = <span class="ruby-string">&quot;999&quot;</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">betweenAppend</span>(<span class="ruby-string">&quot;cnum&quot;</span>, <span class="ruby-node">&quot;#{min_level}&quot;</span>, <span class="ruby-node">&quot;#{max_level}&quot;</span>, <span class="ruby-identifier">qs</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment">#Course Size Search</span>
      <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:min_course_size</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_course_size</span>].<span class="ruby-identifier">blank?</span>
        <span class="ruby-identifier">min_size</span> = <span class="ruby-constant">Integer</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:min_course_size</span>])
        <span class="ruby-identifier">max_size</span> = <span class="ruby-constant">Integer</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:max_course_size</span>])
        <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">betweenAppend</span>(<span class="ruby-string">&quot;csize&quot;</span>, <span class="ruby-node">&quot;#{min_size}&quot;</span>, <span class="ruby-node">&quot;#{max_size}&quot;</span>, <span class="ruby-identifier">qs</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment">#Course Enrollment Search</span>
      <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:min_course_enrollment</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_course_enrollment</span>].<span class="ruby-identifier">blank?</span>
        <span class="ruby-identifier">min_enrollment</span> = <span class="ruby-constant">Integer</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:min_course_enrollment</span>])
        <span class="ruby-identifier">max_enrollment</span> = <span class="ruby-constant">Integer</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:max_course_enrollment</span>])
        <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">betweenAppend</span>(<span class="ruby-string">&quot;enroll&quot;</span>, <span class="ruby-node">&quot;#{min_enrollment}&quot;</span>, <span class="ruby-node">&quot;#{max_enrollment}&quot;</span>, <span class="ruby-identifier">qs</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment"># Course description and notes keyword search!</span>
      <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:keyword</span>].<span class="ruby-identifier">blank?</span>
        <span class="ruby-identifier">temp</span> =<span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-identifier">temp</span> = <span class="ruby-identifier">make_query_string</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:keyword</span>], [<span class="ruby-string">&quot;descrip&quot;</span>, <span class="ruby-string">&quot;short_title&quot;</span>, <span class="ruby-string">&quot;title&quot;</span>, <span class="ruby-string">&quot;xlist1&quot;</span>, <span class="ruby-string">&quot;xlist2&quot;</span>, <span class="ruby-string">&quot;xlist3&quot;</span>, <span class="ruby-string">&quot;prereqs&quot;</span>, <span class="ruby-string">&quot;dept&quot;</span>, <span class="ruby-string">&quot;dept_long&quot;</span>, <span class="ruby-string">&quot;prof_desc&quot;</span>, <span class="ruby-string">&quot;prof_note&quot;</span>], <span class="ruby-identifier">params</span>[<span class="ruby-value">:key_button</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;any&quot;</span>)
        <span class="ruby-identifier">qs</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;( #{temp} )  AND &quot;</span>
      <span class="ruby-keyword">end</span>

<span class="ruby-comment">      # courses last altered since
      unless params[:date][:year].blank? &amp;&amp; params[:date][:month].blank? &amp;&amp; params[:date][:day].blank?
        querydate = &quot;&quot;
        if params[:date][:year].blank?
          querydate &lt;&lt; DateTime.now.year.to_s
        else
          querydate &lt;&lt; params[:date][:year]
        end
        querydate &lt;&lt; &quot;-&quot;
        if params[:date][:month].blank?
          if params[:date][:day].blank?
            querydate &lt;&lt; &quot;01-01&quot;
          else
            querydate &lt;&lt; DateTime.now.month.to_s + &quot;-&quot; + params[:date][:day]
          end
        else
          if params[:date][:day].blank?
            querydate &lt;&lt; params[:date][:month] + &quot;-01&quot;
          else
            querydate &lt;&lt; params[:date][:month] + &quot;-&quot; + params[:date][:day]
          end
        end
        querydate &lt;&lt; &quot; 00:00:00&quot;
        logger.debug querydate

        qs = qs + &quot;last_changed &gt;= &#39;#{querydate}&#39; AND &quot;
      end
</span>
      <span class="ruby-comment"># Removes the trailing &#39; AND &#39; from the query string</span>
      <span class="ruby-value">5</span>.<span class="ruby-identifier">times</span> { <span class="ruby-identifier">qs</span>.<span class="ruby-identifier">chop!</span> }
      <span class="ruby-comment"># Adds &quot;order by&quot; in query string</span>
      <span class="ruby-comment"># qs &lt;&lt; &quot;) ORDER BY dept, cnum, section&quot;</span>
      <span class="ruby-comment"># Course.set_scope(&quot;dept, cnum, section&quot;);</span>
      <span class="ruby-comment"># Performs the search, using the built query string</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@courses</span> = <span class="ruby-constant">Course</span>.<span class="ruby-identifier">all</span>(<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">qs</span>)
<span class="ruby-comment">#    @courses = Course.find_by_sql(qs)</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:cart_id</span>]
      <span class="ruby-ivar">@cart</span> = <span class="ruby-constant">Cart</span>.<span class="ruby-identifier">find_by_cartid</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:cart_id</span>])
      <span class="ruby-ivar">@courses</span> = <span class="ruby-identifier">tag_conflicts</span>(<span class="ruby-ivar">@courses</span>,<span class="ruby-ivar">@cart</span>.<span class="ruby-identifier">get_courses</span>) <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@cart</span>.<span class="ruby-identifier">courses</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment"># highlight the keywords from the keyword field in the course results</span>
    <span class="ruby-ivar">@courses</span> = <span class="ruby-identifier">highlight_keywords</span>(<span class="ruby-ivar">@courses</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">:keyword</span>]) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:keyword</span>].<span class="ruby-identifier">blank?</span>
    <span class="ruby-comment"># Hide cancelled courses unless the crn field was chosen.</span>
    <span class="ruby-ivar">@courses</span>.<span class="ruby-identifier">delete_if</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;cancelled&quot;</span>} <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:crn</span>].<span class="ruby-identifier">blank?</span>
    <span class="ruby-ivar">@courses</span>.<span class="ruby-identifier">delete_if</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;hidden&quot;</span>} <span class="ruby-keyword">unless</span> <span class="ruby-identifier">signed_in?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">faculty_user?</span>(<span class="ruby-identifier">current_user</span>)
    <span class="ruby-ivar">@links</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>()
    <span class="ruby-comment"># Renders the search results</span>
    <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">mobile</span> { <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">root_path</span> }
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">root_path</span> }
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>UPDATE action: empty</p>
          
          

          
          <div class="method-source-code" id="update-source">
            <pre><span class="ruby-comment"># File app/controllers/courses_controller.rb, line 25</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update</span>
  <span class="ruby-identifier">had_error</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-ivar">@course</span> = <span class="ruby-constant">Course</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
  <span class="ruby-ivar">@courses</span> = <span class="ruby-constant">Course</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">semcrn</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@course</span>.<span class="ruby-identifier">semcrn</span>).<span class="ruby-identifier">to_a</span>

  <span class="ruby-comment">#add checked sections into the courses list</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:sections</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:sections</span>].<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@courses</span>=<span class="ruby-ivar">@courses</span><span class="ruby-operator">|</span><span class="ruby-constant">Course</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">semcrn</span><span class="ruby-operator">:</span> <span class="ruby-identifier">s</span>).<span class="ruby-identifier">to_a</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment">#All fields get applied to all checked sections except notify_profs and changed_fields</span>
  <span class="ruby-identifier">section_hash</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@courses</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">section_hash</span>[<span class="ruby-identifier">c</span>.<span class="ruby-identifier">semcrn</span>]=[<span class="ruby-identifier">c</span>.<span class="ruby-identifier">changed_fields</span>,<span class="ruby-identifier">c</span>.<span class="ruby-identifier">notify_profs</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">updates</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:course</span>].<span class="ruby-identifier">clone</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">updates</span>[<span class="ruby-value">:display_prof_note</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;0&quot;</span>
    <span class="ruby-identifier">updates</span>[<span class="ruby-value">:display_prof_note</span>]=<span class="ruby-keyword">false</span>;
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">updates</span>[<span class="ruby-value">:display_prof_note</span>]=<span class="ruby-keyword">true</span>;
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">updates</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&quot;status&quot;</span>)
  <span class="ruby-identifier">updates</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&quot;notify_profs&quot;</span>)
  <span class="ruby-identifier">sec_update</span>=<span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>

  <span class="ruby-ivar">@courses</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sec</span><span class="ruby-operator">|</span>
    
    <span class="ruby-comment">#hide course </span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:course</span>][<span class="ruby-value">:status</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">sec</span>.<span class="ruby-identifier">status</span>.<span class="ruby-identifier">blank?</span>
        <span class="ruby-identifier">section_hash</span>[<span class="ruby-identifier">sec</span>.<span class="ruby-identifier">semcrn</span>][<span class="ruby-value">0</span>]<span class="ruby-operator">||=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-identifier">section_hash</span>[<span class="ruby-identifier">sec</span>.<span class="ruby-identifier">semcrn</span>][<span class="ruby-value">0</span>]<span class="ruby-operator">&lt;&lt;</span><span class="ruby-string">&quot;|&quot;</span><span class="ruby-keyword">unless</span> <span class="ruby-identifier">section_hash</span>[<span class="ruby-identifier">sec</span>.<span class="ruby-identifier">semcrn</span>][<span class="ruby-value">0</span>].<span class="ruby-identifier">blank?</span>
        <span class="ruby-identifier">section_hash</span>[<span class="ruby-identifier">sec</span>.<span class="ruby-identifier">semcrn</span>][<span class="ruby-value">0</span>]<span class="ruby-operator">&lt;&lt;</span><span class="ruby-string">&quot;status&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">section_hash</span>[<span class="ruby-identifier">sec</span>.<span class="ruby-identifier">semcrn</span>][<span class="ruby-value">0</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-string">&quot;status&quot;</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">sec</span>.<span class="ruby-identifier">status</span>=<span class="ruby-string">&quot;hidden&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">sec</span>.<span class="ruby-identifier">status</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;cancelled&quot;</span>
    <span class="ruby-comment">#unhide course</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">sec</span>.<span class="ruby-identifier">status</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;hidden&quot;</span>
        <span class="ruby-identifier">section_hash</span>[<span class="ruby-identifier">sec</span>.<span class="ruby-identifier">semcrn</span>][<span class="ruby-value">0</span>]<span class="ruby-operator">||=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-identifier">section_hash</span>[<span class="ruby-identifier">sec</span>.<span class="ruby-identifier">semcrn</span>][<span class="ruby-value">0</span>]<span class="ruby-operator">&lt;&lt;</span><span class="ruby-string">&quot;|&quot;</span><span class="ruby-keyword">unless</span> <span class="ruby-identifier">section_hash</span>[<span class="ruby-identifier">sec</span>.<span class="ruby-identifier">semcrn</span>][<span class="ruby-value">0</span>].<span class="ruby-identifier">blank?</span>
        <span class="ruby-identifier">section_hash</span>[<span class="ruby-identifier">sec</span>.<span class="ruby-identifier">semcrn</span>][<span class="ruby-value">0</span>]<span class="ruby-operator">&lt;&lt;</span><span class="ruby-string">&quot;status&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">section_hash</span>[<span class="ruby-identifier">sec</span>.<span class="ruby-identifier">semcrn</span>][<span class="ruby-value">0</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-string">&quot;status&quot;</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">sec</span>.<span class="ruby-identifier">status</span>=<span class="ruby-string">&quot;&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">sec</span>.<span class="ruby-identifier">status</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;cancelled&quot;</span> 
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment">#add the fields in the updates hash to the list of changed fields for the section</span>
    <span class="ruby-identifier">updates</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">updates</span>[<span class="ruby-identifier">k</span>] <span class="ruby-operator">!=</span> <span class="ruby-identifier">sec</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">k</span>)
        <span class="ruby-identifier">section_hash</span>[<span class="ruby-identifier">sec</span>.<span class="ruby-identifier">semcrn</span>][<span class="ruby-value">0</span>]<span class="ruby-operator">||=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-keyword">unless</span> <span class="ruby-identifier">section_hash</span>[<span class="ruby-identifier">sec</span>.<span class="ruby-identifier">semcrn</span>][<span class="ruby-value">0</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">k</span>)
          <span class="ruby-identifier">section_hash</span>[<span class="ruby-identifier">sec</span>.<span class="ruby-identifier">semcrn</span>][<span class="ruby-value">0</span>]<span class="ruby-operator">&lt;&lt;</span><span class="ruby-string">&quot;|&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">section_hash</span>[<span class="ruby-identifier">sec</span>.<span class="ruby-identifier">semcrn</span>][<span class="ruby-value">0</span>].<span class="ruby-identifier">blank?</span>
          <span class="ruby-identifier">section_hash</span>[<span class="ruby-identifier">sec</span>.<span class="ruby-identifier">semcrn</span>][<span class="ruby-value">0</span>]<span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">k</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">section_hash</span>[<span class="ruby-identifier">sec</span>.<span class="ruby-identifier">semcrn</span>][<span class="ruby-value">0</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">k</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment">#It won&#39;t change the field if it is the empty string, so this sets it to nil so it can be edited</span>
    <span class="ruby-identifier">sec</span>.<span class="ruby-identifier">notify_profs</span>=<span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">sec</span>.<span class="ruby-identifier">notify_profs!</span>=<span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">sec</span>.<span class="ruby-identifier">notify_profs</span>.<span class="ruby-identifier">empty?</span>

    <span class="ruby-comment">#Adds/removes the professor to notify profs</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:course</span>][<span class="ruby-value">:notify_profs</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-identifier">temp_str</span> = <span class="ruby-identifier">sec</span>.<span class="ruby-identifier">notify_profs</span> 
      <span class="ruby-identifier">temp_str</span><span class="ruby-operator">||=</span><span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-keyword">unless</span> <span class="ruby-identifier">temp_str</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">email</span>)
        <span class="ruby-identifier">temp_str</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-string">&quot;|&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">temp_str</span>.<span class="ruby-identifier">blank?</span>
        <span class="ruby-identifier">temp_str</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">email</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">section_hash</span>[<span class="ruby-identifier">sec</span>.<span class="ruby-identifier">semcrn</span>][<span class="ruby-value">1</span>]=<span class="ruby-identifier">temp_str</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">sec</span>.<span class="ruby-identifier">notify_profs</span>.<span class="ruby-identifier">blank?</span> 
      <span class="ruby-identifier">temp_arr</span> = <span class="ruby-identifier">sec</span>.<span class="ruby-identifier">notify_profs</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;|&quot;</span>)
      <span class="ruby-identifier">temp_arr</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">email</span>)
      <span class="ruby-identifier">temp_str</span>=<span class="ruby-identifier">temp_arr</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;|&quot;</span>)
      <span class="ruby-identifier">section_hash</span>[<span class="ruby-identifier">sec</span>.<span class="ruby-identifier">semcrn</span>][<span class="ruby-value">1</span>]=<span class="ruby-identifier">temp_str</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">updates</span>[<span class="ruby-value">:recent_edit</span>]=<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">email</span>
  
  <span class="ruby-comment">#Updates the courses</span>
  <span class="ruby-ivar">@courses</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">updates</span>[<span class="ruby-value">:changed_fields</span>]=<span class="ruby-identifier">section_hash</span>[<span class="ruby-identifier">c</span>.<span class="ruby-identifier">semcrn</span>][<span class="ruby-value">0</span>]
    <span class="ruby-identifier">updates</span>[<span class="ruby-value">:notify_profs</span>]=<span class="ruby-identifier">section_hash</span>[<span class="ruby-identifier">c</span>.<span class="ruby-identifier">semcrn</span>][<span class="ruby-value">1</span>]
    <span class="ruby-identifier">temp_bool</span>=<span class="ruby-identifier">c</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">updates</span>)
    <span class="ruby-identifier">had_error</span><span class="ruby-operator">||=</span><span class="ruby-operator">!</span><span class="ruby-identifier">temp_bool</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">had_error</span>
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:success</span>]=<span class="ruby-string">&quot;Course(s) successfully updated!&quot;</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">course_edit_path</span>(<span class="ruby-ivar">@course</span>.<span class="ruby-identifier">semcrn</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">course_edit_path</span>(<span class="ruby-ivar">@course</span>.<span class="ruby-identifier">semcrn</span>),<span class="ruby-value">:notice=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;Course(s) could not be updated. Please contact the prestissimo managers.&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

